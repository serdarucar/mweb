<div class="container">
  <br><br><br>
  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default">
        <div class="panel-body">
          <h2 align="center"><b>MAIL SENDING PROGRESS</b></h2>
          {{#if nomail}}
          <div class="jumbotron">
            <div class="row">
              <h3 align="center">THERE ARE NO MAILS SENT FOR THIS DAY.</h3>
            </div>
          {{else}}
          <div class="jumbotron">
            <div class="row" onclick="location='/session/{{result.sid}}/10'">
              <div class="col-lg-4 mail-sent">
                <h1 id="{{result.sid}}:sent" align="center">{{result.sent}}</h1>
                <h6 align="center">SENT</h6>
              </div>
              <div class="col-lg-4 mail-deferred">
                <h1 id="{{result.sid}}:deferred" align="center">{{result.deferred}}</h1>
                <h6 align="center">DEFERRED</h6>
              </div>
              <div class="col-lg-4 mail-bounced">
                <h1 id="{{result.sid}}:bounced" align="center">{{result.bounced}}</h1>
                <h6 align="center">BOUNCED</h6>
              </div>
            </div>
            <br>
            <div class="progress">
              <div class="progress-bar progress-bar-success" style="width: 35%"></div>
              <div class="progress-bar progress-bar-warning" style="width: 20%"></div>
              <div class="progress-bar progress-bar-danger" style="width: 10%"></div>
            </div>
            <br>
            <div class="row">
              <div class="col-lg-3">
                <h5 align="center"><i class="fa fa-clock-o"></i>   {{prettifyTime result.time}}</h5>
              </div>
              <div class="col-lg-3" title="Sender">
                <h5 align="center"><i class="fa fa-user"></i>   {{result.sender}}</h5>
              </div>
              <div class="col-lg-3" title="Recipient">
                <h5 align="center"><i class="fa fa-users"></i>   Some List</h5>
              </div>
              <div class="col-lg-3" title="Processed / Accepted">
                <h5 align="center"><i class="fa fa-tachometer"></i>   <span id="{{result.sid}}:total">{{result.process}}</span> / {{result.count}} ({{result.sid}})</h5>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="well">
        {{{result.mbody}}}
      </div>
      {{/if}}
    </div>
  </div>
</div>

<script>
/*
  var mbody = document.getElementById("hidden-mail-body").innerHTML;
  console.log(mbody);
  var reg = /\<body[^>]*\>([^]*)\<\/body/m;
  var nbody = mbody.match( reg )[1];
  console.log(nbody);
  document.write(nbody);
  //document.getElementById('visible-mail-body').innerHTML = $mbody.match( reg )[1];


  $(document).ready(function() {
    $mbody = this().getElementById('hidden-mail-body').innerHTML;
    var reg = /\<body[^>]*\>([^]*)\<\/body/m;
    this().getElementById('visible-mail-body').innerHTML = $mbody.match( reg )[1];
  });
*/

  var io = io.connect();
  io.on("mailstats", function(data) {
    document.getElementById(data.new_val.sid + ':sent').innerHTML = data.new_val.sent;
    document.getElementById(data.new_val.sid + ':deferred').innerHTML = data.new_val.deferred;
    document.getElementById(data.new_val.sid + ':bounced').innerHTML = data.new_val.bounced;
    document.getElementById(data.new_val.sid + ':total').innerHTML = data.new_val.sent + data.new_val.deferred + data.new_val.bounced;
  });

</script>
